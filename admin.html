<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AN. Admin Panel</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display.swap" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        :root { --bg-color: #030712; --text-color: #f3f4f6; --text-secondary: #9ca3af; --card-bg: #1f2937; --border-color: #374151; --input-bg: #1f2937; --input-border: #4b5563; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); }
        .form-input { background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color); transition: .2s; }
        .form-input:focus { border-color:#3B82F6; outline:0; box-shadow:0 0 0 3px rgba(59,130,246,.2); }
        [x-cloak] { display: none !important; }
        .ql-toolbar { border-bottom: 1px solid var(--border-color) !important; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .ql-container.ql-snow { border: 1px solid var(--input-border) !important; border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        .ql-editor { color: var(--text-color); } .ql-editor.ql-blank::before { color: var(--text-secondary); }
        .ql-toolbar .ql-stroke, .ql-toolbar .ql-fill, .ql-toolbar .ql-picker-label { stroke: var(--text-secondary); fill: var(--text-secondary); color: var(--text-secondary); }
        .tab-btn { border-color: transparent; } .tab-btn.active { color: #3B82F6; border-color: #3B82F6; }
    </style>
</head>
<body x-data="adminPanel()">

    <!-- LOGIN FORM -->
    <div x-show="!loggedIn" x-cloak class="min-h-screen w-full flex items-center justify-center p-4">
        <div class="w-full max-w-sm bg-[var(--card-bg)] border border-[var(--border-color)] p-8 rounded-2xl">
            <h1 class="text-3xl font-bold text-center mb-6">Unified Admin Login</h1>
            <form @submit.prevent="login" class="space-y-4">
                <div><label>Email</label><input type="email" x-model="email" required class="form-input w-full p-3 rounded-lg mt-1"></div>
                <div><label>Password</label><input type="password" x-model="password" required class="form-input w-full p-3 rounded-lg mt-1"></div>
                <button type="submit" class="w-full bg-blue-600 font-bold py-3 rounded-full hover:bg-blue-700">Login</button>
                <p x-text="loginError" class="text-red-400 text-sm text-center"></p>
            </form>
        </div>
    </div>

    <!-- UNIFIED ADMIN DASHBOARD -->
    <div x-show="loggedIn" x-cloak class="flex min-h-screen w-full">
        <!-- SIDEBAR NAVIGATION -->
        <aside class="w-20 lg:w-64 bg-gray-900 p-4 lg:p-6 flex flex-col shrink-0 transition-all duration-300">
            <h1 class="text-2xl font-extrabold tracking-tight text-center lg:text-left">
                <span class="lg:hidden">AN.</span>
                <span class="hidden lg:inline">AN. Admin</span>
            </h1>
            <nav class="mt-8 space-y-2">
                <button @click="activeTab = 'dashboard'" :class="{'bg-blue-600 text-white': activeTab === 'dashboard', 'hover:bg-gray-800 text-gray-400': activeTab !== 'dashboard'}" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span class="hidden lg:inline">Dashboard</span>
                </button>
                <button @click="activeTab = 'projects'; loadProjects()" :class="{'bg-blue-600 text-white': activeTab === 'projects', 'hover:bg-gray-800 text-gray-400': activeTab !== 'projects'}" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span class="hidden lg:inline">Projects</span>
                </button>
                <button @click="activeTab = 'products'; loadProducts()" :class="{'bg-blue-600 text-white': activeTab === 'products', 'hover:bg-gray-800 text-gray-400': activeTab !== 'products'}" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                    <span class="hidden lg:inline">Products</span>
                </button>
                <button @click="activeTab = 'apps'; loadApps()" :class="{'bg-blue-600 text-white': activeTab === 'apps', 'hover:bg-gray-800 text-gray-400': activeTab !== 'apps'}" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    <span class="hidden lg:inline">Apps</span>
                </button>
                <button @click="activeTab = 'blog'; loadPosts()" :class="{'bg-blue-600 text-white': activeTab === 'blog', 'hover:bg-gray-800 text-gray-400': activeTab !== 'blog'}" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 12h6M7 8h6"></path></svg>
                    <span class="hidden lg:inline">Blog</span>
                </button>
            </nav>
            <div class="mt-auto">
                <button @click="logout" class="w-full flex items-center justify-center lg:justify-start gap-3 px-4 py-3 text-gray-400 hover:bg-red-600 hover:text-white rounded-lg transition-colors">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span class="hidden lg:inline">Logout</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 p-4 sm:p-8 overflow-y-auto">
            <!-- Dashboard Tab -->
            <div x-show="activeTab === 'dashboard'" x-transition>
                <h1 class="text-3xl font-bold mb-8">Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gray-900 p-6 rounded-2xl"><h2 class="text-gray-400">Total Projects</h2><p x-text="stats.projects" class="text-4xl font-bold mt-2"></p></div>
                    <div class="bg-gray-900 p-6 rounded-2xl"><h2 class="text-gray-400">Total Products</h2><p x-text="stats.products" class="text-4xl font-bold mt-2"></p></div>
                    <div class="bg-gray-900 p-6 rounded-2xl"><h2 class="text-gray-400">Total Apps</h2><p x-text="stats.apps" class="text-4xl font-bold mt-2"></p></div>
                    <div class="bg-gray-900 p-6 rounded-2xl"><h2 class="text-gray-400">Total Blog Posts</h2><p x-text="stats.posts" class="text-4xl font-bold mt-2"></p></div>
                </div>
            </div>

            <!-- Projects Tab -->
            <div x-show="activeTab === 'projects'" x-cloak x-transition>
                <h1 class="text-3xl font-bold mb-8">Manage Projects</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1"><form @submit.prevent="saveProject" class="space-y-4 p-6 bg-gray-900 rounded-2xl"><h2 x-text="projectFormMode === 'add' ? 'Add New Project' : 'Edit Project'" class="text-2xl font-bold"></h2><input type="hidden" x-model="projectId"><div><label>Project Title*</label><input type="text" x-model="projectTitle" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Description*</label><textarea x-model="projectDesc" rows="4" required class="form-input w-full mt-1 p-2 rounded-md"></textarea></div><div><label>Image Filename*</label><input type="text" x-model="projectImage" required class="form-input w-full mt-1 p-2 rounded-md"><p class="text-xs text-gray-400 mt-1">Upload to `assets/project/`</p></div><div><label>Tags (comma-separated)</label><input type="text" x-model="projectTags" class="form-input w-full mt-1 p-2 rounded-md"></div><div class="pt-4 border-t border-gray-700"><h3 class="font-semibold">Custom Buttons (Optional)</h3><div class="space-y-2 mt-2"><div class="grid grid-cols-2 gap-2"><input type="text" x-model="projectBtn1Text" class="form-input p-2 rounded-md" placeholder="Btn 1 Text"><input type="text" x-model="projectBtn1Link" class="form-input p-2 rounded-md" placeholder="Btn 1 Link"></div><div class="grid grid-cols-2 gap-2"><input type="text" x-model="projectBtn2Text" class="form-input p-2 rounded-md" placeholder="Btn 2 Text"><input type="text" x-model="projectBtn2Link" class="form-input p-2 rounded-md" placeholder="Btn 2 Link"></div><div class="grid grid-cols-2 gap-2"><input type="text" x-model="projectBtn3Text" class="form-input p-2 rounded-md" placeholder="Btn 3 Text"><input type="text" x-model="projectBtn3Link" class="form-input p-2 rounded-md" placeholder="Btn 3 Link"></div><div class="grid grid-cols-2 gap-2"><input type="text" x-model="projectBtn4Text" class="form-input p-2 rounded-md" placeholder="Btn 4 Text"><input type="text" x-model="projectBtn4Link" class="form-input p-2 rounded-md" placeholder="Btn 4 Link"></div></div></div><div class="flex gap-4 pt-4"><button type="submit" class="w-full bg-blue-600 font-bold py-3 rounded-full hover:bg-blue-700">Save Project</button><button type="button" x-show="projectFormMode === 'edit'" @click="resetProjectForm" class="w-full bg-gray-600 font-bold py-3 rounded-full hover:bg-gray-700">Cancel</button></div></form></div>
                    <div class="lg:col-span-2 p-6 bg-gray-900 rounded-2xl"><h2 class="text-2xl font-bold mb-4">Existing Projects</h2><div x-html="projectsListHTML" @click="handleItemClick" class="space-y-3"></div></div>
                </div>
            </div>

            <!-- Products Tab -->
            <div x-show="activeTab === 'products'" x-cloak x-transition>
                <h1 class="text-3xl font-bold mb-8">Manage Products</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1"><form @submit.prevent="saveProduct" class="space-y-4 p-6 bg-gray-900 rounded-2xl"><h2 x-text="productFormMode === 'add' ? 'Add New Product' : 'Edit Product'" class="text-2xl font-bold"></h2><input type="hidden" x-model="productId"><div><label>Product Name*</label><input type="text" x-model="productName" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Description*</label><textarea x-model="productDesc" rows="5" required class="form-input w-full mt-1 p-2 rounded-md"></textarea></div><div><label>Original Price ($)*</label><input type="number" step="0.01" x-model="productPrice" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Sale Price ($) (0 if none)</label><input type="number" step="0.01" x-model="productSalePrice" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Category*</label><input type="text" x-model="productCategory" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Image Filenames* (comma-separated)</label><input type="text" x-model="productImages" required class="form-input w-full mt-1 p-2 rounded-md"><p class="text-xs text-gray-400 mt-1">Upload to `assets/product/`</p></div><div class="flex gap-4 pt-4"><button type="submit" class="w-full bg-blue-600 font-bold py-3 rounded-full hover:bg-blue-700">Save Product</button><button type="button" x-show="productFormMode === 'edit'" @click="resetProductForm" class="w-full bg-gray-600 font-bold py-3 rounded-full hover:bg-gray-700">Cancel</button></div></form></div>
                    <div class="lg:col-span-2 p-6 bg-gray-900 rounded-2xl"><h2 class="text-2xl font-bold mb-4">Existing Products</h2><div x-html="productsListHTML" @click="handleItemClick" class="space-y-3"></div></div>
                </div>
            </div>

            <!-- Apps Tab -->
            <div x-show="activeTab === 'apps'" x-cloak x-transition>
                <h1 class="text-3xl font-bold mb-8">Manage Apps</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1"><form @submit.prevent="saveApp" class="space-y-4 p-6 bg-gray-900 rounded-2xl"><h2 x-text="appFormMode === 'add' ? 'Add New App' : 'Edit App'" class="text-2xl font-bold"></h2><input type="hidden" x-model="appId"><div><label>App Name*</label><input type="text" x-model="appName" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Subtitle*</label><input type="text" x-model="appSubtitle" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Description*</label><textarea x-model="appDesc" rows="5" required class="form-input w-full mt-1 p-2 rounded-md"></textarea></div><div><label>Folder Name*</label><input type="text" x-model="appFolder" required class="form-input w-full mt-1 p-2 rounded-md"><p class="text-xs text-gray-400 mt-1">Path: `assets/apps/folder/`</p></div><div class="grid grid-cols-2 gap-4"><div><label>Icon*</label><input type="text" x-model="appIcon" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Banner*</label><input type="text" x-model="appBanner" required class="form-input w-full mt-1 p-2 rounded-md"></div></div><div><label>Screenshots* (comma-separated)</label><input type="text" x-model="appScreenshots" required class="form-input w-full mt-1 p-2 rounded-md"></div><div class="grid grid-cols-3 gap-4"><div><label>Rating*</label><input type="text" x-model="appRating" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Downloads*</label><input type="text" x-model="appDownloads" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Users*</label><input type="text" x-model="appUsers" required class="form-input w-full mt-1 p-2 rounded-md"></div></div><div class="grid grid-cols-2 gap-4"><div><label>Android Link (Optional)</label><input type="text" x-model="appAndroidLink" class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>iOS Link (Optional)</label><input type="text" x-model="appIosLink" class="form-input w-full mt-1 p-2 rounded-md"></div></div><div class="grid grid-cols-2 gap-4"><div><label>Company*</label><input type="text" x-model="appCompany" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Email*</label><input type="email" x-model="appEmail" required class="form-input w-full mt-1 p-2 rounded-md"></div></div><div><label>Launch Date*</label><input type="date" x-model="appLaunchDate" required class="form-input w-full mt-1 p-2 rounded-md"></div><div class="flex gap-4 pt-4"><button type="submit" class="w-full bg-blue-600 font-bold py-3 rounded-full hover:bg-blue-700">Save App</button><button type="button" x-show="appFormMode === 'edit'" @click="resetAppForm" class="w-full bg-gray-600 font-bold py-3 rounded-full hover:bg-gray-700">Cancel</button></div></form></div>
                    <div class="lg:col-span-2 space-y-8"><div class="p-6 bg-gray-900 rounded-2xl"><h2 class="text-2xl font-bold mb-4">Existing Apps</h2><div x-html="appsListHTML" @click="handleItemClick" class="space-y-3"></div></div><div class="p-6 bg-gray-900 rounded-2xl"><h2 class="text-2xl font-bold mb-4">Manage Reviews</h2><div x-html="reviewsListHTML" @click="handleReviewClick"></div></div></div>
                </div>
            </div>

            <!-- Blog Tab -->
            <div x-show="activeTab === 'blog'" x-cloak x-transition>
                <h1 class="text-3xl font-bold mb-8">Manage Blog Posts</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1"><form @submit.prevent="savePost" class="space-y-4 p-6 bg-gray-900 rounded-2xl"><h2 x-text="postFormMode === 'add' ? 'Add New Post' : 'Edit Post'" class="text-2xl font-bold"></h2><input type="hidden" x-model="postId"><div><label>Post Title*</label><input type="text" x-model="postTitle" required class="form-input w-full mt-1 p-2 rounded-md"></div><div><label>Post Content*</label><div id="editor-container" class="h-64 bg-gray-800 text-white rounded-lg"></div></div><div><label>Main Image Filename*</label><input type="text" x-model="postImage" required class="form-input w-full mt-1 p-2 rounded-md"><p class="text-xs text-gray-400 mt-1">Upload to `assets/blog/`</p></div><div class="flex gap-4 pt-4"><button type="submit" class="w-full bg-blue-600 font-bold py-3 rounded-full hover:bg-blue-700">Save Post</button><button type="button" x-show="postFormMode === 'edit'" @click="resetPostForm" class="w-full bg-gray-600 font-bold py-3 rounded-full hover:bg-gray-700">Cancel</button></div></form></div>
                    <div class="lg:col-span-2 p-6 bg-gray-900 rounded-2xl"><h2 class="text-2xl font-bold mb-4">Existing Posts</h2><div x-html="postsListHTML" @click="handleItemClick" class="space-y-3"></div></div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBO54U5WtwR3rfDDHFgDbPzwF-V27Ml5m4", authDomain: "portfolio-87299.firebaseapp.com", projectId: "portfolio-87299",
            storageBucket: "portfolio-87299.firebasestorage.app", messagingSenderId: "458111444495", appId: "1:458111444495:web:f290b11f480e6ad1fe657a", measurementId: "G-6EYBX1VE63"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const quill = new Quill('#editor-container', { theme: 'snow', modules: { toolbar: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', 'link'], [{ 'list': 'ordered'}, { 'list': 'bullet' }], ['clean']] } });

        function adminPanel() {
            return {
                loggedIn: false, email: '', password: '', loginError: '',
                activeTab: 'dashboard',
                stats: { projects: 0, products: 0, apps: 0, posts: 0 },
                
                projectFormMode: 'add', projectId: '', projectTitle: '', projectDesc: '', projectImage: '', projectTags: '', projectBtn1Text: '', projectBtn1Link: '', projectBtn2Text: '', projectBtn2Link: '', projectBtn3Text: '', projectBtn3Link: '', projectBtn4Text: '', projectBtn4Link: '', projectsListHTML: '<p>Loading...</p>',
                productFormMode: 'add', productId: '', productName: '', productDesc: '', productPrice: 0, productSalePrice: 0, productCategory: '', productImages: '', productsListHTML: '<p>Loading...</p>',
                appFormMode: 'add', appId: '', appName: '', appSubtitle: '', appDesc: '', appFolder: '', appIcon: '', appBanner: '', appScreenshots: '', appRating: '', appDownloads: '', appUsers: '', appAndroidLink: '', appIosLink: '', appCompany: '', appEmail: '', appLaunchDate: '', appsListHTML: '<p>Loading...</p>', reviewsListHTML: '<p>Select an app to see reviews.</p>',
                postFormMode: 'add', postId: '', postTitle: '', postImage: '', postsListHTML: '<p>Loading...</p>',

                init() {
                    auth.onAuthStateChanged(user => {
                        this.loggedIn = !!user;
                        if (this.loggedIn) { this.loadAllData(); } 
                        else { this.activeTab = 'dashboard'; }
                    });
                },
                login() { auth.signInWithEmailAndPassword(this.email, this.password).catch(err => this.loginError = err.message); },
                logout() { auth.signOut(); },

                async loadAllData() {
                    this.loadProjects(); this.loadProducts(); this.loadApps(); this.loadPosts();
                },
                
                // --- PROJECTS ---
                async loadProjects() {
                    const snapshot = await db.collection('projects').orderBy('createdAt', 'desc').get();
                    this.stats.projects = snapshot.size;
                    this.projectsListHTML = snapshot.empty ? `<p>No projects yet.</p>` : snapshot.docs.map(doc => `<div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg"><p class="font-semibold">${doc.data().title}</p><div class="flex gap-2"><button class="edit-btn text-yellow-400 text-sm" data-type="project" data-id="${doc.id}">Edit</button><button class="delete-btn text-red-400 text-sm" data-type="project" data-id="${doc.id}">Delete</button></div></div>`).join('');
                },
                async saveProject() {
                    const data = { title: this.projectTitle, description: this.projectDesc, image: this.projectImage, tags: this.projectTags.split(',').map(s=>s.trim()).filter(Boolean), button1Text: this.projectBtn1Text, button1Link: this.projectBtn1Link, button2Text: this.projectBtn2Text, button2Link: this.projectBtn2Link, button3Text: this.projectBtn3Text, button3Link: this.projectBtn3Link, button4Text: this.projectBtn4Text, button4Link: this.projectBtn4Link };
                    if (this.projectFormMode === 'add') { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('projects').add(data); } else { await db.collection('projects').doc(this.projectId).update(data); }
                    alert('Project saved!'); this.resetProjectForm(); this.loadProjects();
                },
                resetProjectForm() { this.projectFormMode='add'; this.projectId=''; this.projectTitle=''; this.projectDesc=''; this.projectImage=''; this.projectTags=''; this.projectBtn1Text=''; this.projectBtn1Link=''; this.projectBtn2Text=''; this.projectBtn2Link=''; this.projectBtn3Text=''; this.projectBtn3Link=''; this.projectBtn4Text=''; this.projectBtn4Link=''; },

                // --- PRODUCTS ---
                async loadProducts() {
                    const snapshot = await db.collection('products').orderBy('createdAt', 'desc').get();
                    this.stats.products = snapshot.size;
                    this.productsListHTML = snapshot.empty ? `<p>No products yet.</p>` : snapshot.docs.map(doc => `<div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg"><p class="font-semibold">${doc.data().name}</p><div class="flex gap-2"><button class="edit-btn text-yellow-400 text-sm" data-type="product" data-id="${doc.id}">Edit</button><button class="delete-btn text-red-400 text-sm" data-type="product" data-id="${doc.id}">Delete</button></div></div>`).join('');
                },
                async saveProduct() {
                    const data = { name: this.productName, description: this.productDesc, price: parseFloat(this.productPrice), salePrice: parseFloat(this.productSalePrice), category: this.productCategory, images: this.productImages.split(',').map(s=>s.trim()) };
                    if (this.productFormMode === 'add') { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('products').add(data); } else { await db.collection('products').doc(this.productId).update(data); }
                    alert('Product saved!'); this.resetProductForm(); this.loadProducts();
                },
                resetProductForm() { this.productFormMode='add'; this.productId=''; this.productName=''; this.productDesc=''; this.productPrice=0; this.productSalePrice=0; this.productCategory=''; this.productImages=''; },
                
                // --- APPS ---
                async loadApps() { 
                    const snapshot = await db.collection('apps').orderBy('createdAt', 'desc').get();
                    this.stats.apps = snapshot.size;
                    this.appsListHTML = snapshot.empty ? `<p>No apps yet.</p>` : snapshot.docs.map(doc => `<div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg"><p class="font-semibold">${doc.data().name}</p><div class="flex gap-4"><button class="reviews-btn text-blue-400 text-sm" data-type="app" data-id="${doc.id}">Reviews</button><button class="edit-btn text-yellow-400 text-sm" data-type="app" data-id="${doc.id}">Edit</button><button class="delete-btn text-red-400 text-sm" data-type="app" data-id="${doc.id}">Delete</button></div></div>`).join('');
                },
                async loadReviews(appId) { 
                    this.reviewsListHTML = `<p>Loading reviews...</p>`;
                    const snapshot = await db.collection('apps').doc(appId).collection('reviews').orderBy('createdAt','desc').get();
                    this.reviewsListHTML = snapshot.empty ? `<p>No reviews for this app.</p>` : snapshot.docs.map(doc => { 
                        const r = doc.data(); 
                        const replyForm = !r.reply ? `<form class="reply-form mt-2 flex gap-2" data-appid="${appId}" data-reviewid="${doc.id}"><input type="text" class="form-input flex-1 p-1 rounded" placeholder="Reply..."><button type="submit" class="bg-blue-600 px-3 py-1 text-sm rounded">Send</button></form>` : `<p class="mt-2 text-sm text-green-400"><strong>Replied:</strong> ${r.reply}</p>`; 
                        return `<div class="bg-gray-800 p-3 rounded-lg mb-2"><div class="flex justify-between items-start"><div class="pr-4"><p><strong>${r.name}</strong> (${r.email})</p><p class="text-sm text-gray-400">${r.message}</p></div><button class="delete-review-btn text-red-500 hover:text-red-400 text-xs shrink-0" data-appid="${appId}" data-reviewid="${doc.id}">Delete</button></div>${replyForm}</div>`; 
                    }).join('');
                },
                async saveApp() {
                    const data = { name: this.appName, subtitle: this.appSubtitle, description: this.appDesc, folderName: this.appFolder, icon: this.appIcon, banner: this.appBanner, screenshots: this.appScreenshots.split(',').map(s=>s.trim()), rating: this.appRating, downloads: this.appDownloads, users: this.appUsers, androidLink: this.appAndroidLink, iosLink: this.appIosLink, companyName: this.appCompany, supportEmail: this.appEmail, launchDate: this.appLaunchDate };
                    if (this.appFormMode === 'add') { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('apps').add(data); } else { await db.collection('apps').doc(this.appId).update(data); }
                    alert('App saved!'); this.resetAppForm(); this.loadApps();
                },
                resetAppForm() { this.appFormMode='add'; this.appId=''; this.appName=''; this.appSubtitle=''; this.appDesc=''; this.appFolder=''; this.appIcon=''; this.appBanner=''; this.appScreenshots=''; this.appRating=''; this.appDownloads=''; this.appUsers=''; this.appAndroidLink=''; this.appIosLink=''; this.appCompany=''; this.appEmail=''; this.appLaunchDate=''; },

                // --- BLOG ---
                async loadPosts() {
                    const snapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
                    this.stats.posts = snapshot.size;
                    this.postsListHTML = snapshot.empty ? `<p>No posts yet.</p>` : snapshot.docs.map(doc => `<div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg"><p class="font-semibold">${doc.data().title}</p><div class="flex gap-2"><button class="edit-btn text-yellow-400 text-sm" data-type="post" data-id="${doc.id}">Edit</button><button class="delete-btn text-red-400 text-sm" data-type="post" data-id="${doc.id}">Delete</button></div></div>`).join('');
                },
                async savePost() {
                    const postData = { title: this.postTitle, content: quill.root.innerHTML, imageUrl: this.postImage };
                    if (this.postFormMode === 'add') { postData.timestamp = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('posts').add(postData); } else { await db.collection('posts').doc(this.postId).update(postData); }
                    alert('Post saved!'); this.resetPostForm(); this.loadPosts();
                },
                resetPostForm() { this.postFormMode='add'; this.postId=''; this.postTitle=''; this.postImage=''; quill.root.innerHTML=''; },

                // --- EVENT HANDLERS ---
                async handleItemClick(e) {
                    const {type, id} = e.target.dataset;
                    if (!type || !id) return;
                    
                    if (e.target.classList.contains('delete-btn')) {
                        if (confirm('Are you sure?')) {
                            await db.collection(type + 's').doc(id).delete();
                            alert(`${type.charAt(0).toUpperCase() + type.slice(1)} deleted!`);
                            this[`load${type.charAt(0).toUpperCase() + type.slice(1)}s`]();
                        }
                    } else if (e.target.classList.contains('edit-btn')) {
                        const docSnap = await db.collection(type + 's').doc(id).get();
                        const data = docSnap.data();
                        this[`${type}FormMode`] = 'edit';
                        this[`${type}Id`] = id;
                        if (type === 'project') { this.projectTitle = data.title; this.projectDesc = data.description; this.projectImage = data.image; this.projectTags = data.tags?data.tags.join(', '):''; for(let i=1;i<=4;i++){this[`projectBtn${i}Text`]=data[`button${i}Text`]||'';this[`projectBtn${i}Link`]=data[`button${i}Link`]||'';} }
                        if (type === 'product') { this.productName = data.name; this.productDesc = data.description; this.productPrice = data.price; this.productSalePrice = data.salePrice; this.productCategory = data.category; this.productImages = data.images.join(', '); }
                        if (type === 'app') { this.appName = data.name; this.appSubtitle = data.subtitle; this.appDesc = data.description; this.appFolder = data.folderName; this.appIcon = data.icon; this.appBanner = data.banner; this.appScreenshots = data.screenshots.join(', '); this.appRating = data.rating; this.appDownloads = data.downloads; this.appUsers = data.users; this.appAndroidLink = data.androidLink; this.appIosLink = data.iosLink; this.appCompany = data.companyName; this.appEmail = data.supportEmail; this.appLaunchDate = data.launchDate; }
                        if (type === 'post') { this.postTitle = data.title; this.postImage = data.imageUrl; quill.root.innerHTML = data.content; }
                        window.scrollTo(0, 0);
                    } else if (e.target.classList.contains('reviews-btn')) {
                        this.loadReviews(id);
                    }
                },
                
                async handleReviewClick(e) {
                    if(e.target.closest('.reply-form')) {
                        e.preventDefault(); const form = e.target.closest('.reply-form'); const replyText = form.querySelector('input').value; if(!replyText) return; const {appid, reviewid} = form.dataset;
                        await db.collection('apps').doc(appid).collection('reviews').doc(reviewid).update({reply: replyText}); alert('Reply sent!'); this.loadReviews(appid);
                    }
                    if(e.target.classList.contains('delete-review-btn')) {
                        const {appid, reviewid} = e.target.dataset;
                        if(confirm('Are you sure you want to delete this review?')) { await db.collection('apps').doc(appid).collection('reviews').doc(reviewid).delete(); alert('Review deleted!'); this.loadReviews(appid); }
                    }
                }
            }
        }
    </script>
</body>
</html>